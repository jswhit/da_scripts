git clone https://github.com/jswhit/da_scripts C96_3dvar_iau
cd C96_3dvar_iau
git checkout 3dvar_workflow
git submodule update --init --recursive # to checkout build_gsinfo submodule

config.sh is main script, hpss.sh is script to archive on hpss
${machine}_preamble is job scheduler preamble for config.sh
${machine}_preamble_hpss is job scheduler preamble for hpss.sh
submit_job.sh <machine> submits config.sh (which then submits itself and hpss.sh).
most model namelist parameters set in the suite specific namelist file (FV3*nml).
most of GSI namelist parameters set in run_gsi_4denvar.sh, some in config.sh.
Resolution specific processor layout stuff for FV3 is set in <machine>_preamble_

Currently set up to use GFSv17.HR1 physics configuration and ufs-weather-model develop from 20231109.

To cold start, create an initial directory in the experiment directory (i.e <expthome>/YYYYMMDDHH)
Use replay restarts (from /NCEPDEV/cpcnudge/5year/Yan.1.Wang/ERA5_ORAS5_replay_C96mx100/RESTART_FILES for
C96) to populate the directory.
Grab bias correction files (gdas*t*bias*) from NCEP runhistory to put in that directory.
If you don't have these, 
touch an empty file (touch <expthome>/YYYYMMDDHH/cold_start_bias).  This will tell the scripts
that there is no initial bias correction file.  To generate initial bias files with zeros,
run build_gsinfo/initbias.py with a satinfo file generated by createsatinfo.sh for the first date
of your experiment.  Copy the generated zero_abias, zero_abias_pc files to gdas.tHHz.abias, gdas.tHHz.abias_pc 
to <expthome>/YYYYMMDDHH. Create an empty aircraft bias correction file by touching gdas.tHHz.abias_air.

You will also need to put an increment file (fv3_increment6.nc) in control/INPUT. There is one
on orion at /work/noaa/gsienkf/whitaker/ics/C96_fv3_increment6_zeros.nc.

Create analdate.sh and fg_only.sh in the top level experiment directory (<expthome>).
fg_only should contain "export fg_only=true" plus "export cold_start=false" and "export skip_calc_increment=1"
and analdate.csh should contain
"export analdate=YYYYMMDDHH1" and "export analdate_end=YYYYMMDDHH2", where YYYYMMDDHH1,2 is the
date you want the experiment to start and end.

executables need to be in exec_<machine>.  For example, 
[jwhitake@hercules-login-4 C96_3dvar_iau]$ ls -l exec_hercules/
total 199820
-rwxr-x--- 1 jwhitake gsienkf   1766264 Nov  8 11:59 calc_increment_ncio.x
-rwxr-x--- 1 jwhitake gsienkf 128521088 Nov 10 10:56 fv3-nonhydro.exe
-rwxr-x--- 1 jwhitake gsienkf  12832360 Nov 10 10:57 global_enkf
-rwxr-x--- 1 jwhitake gsienkf  65461104 Nov 10 10:57 global_gsi
global_enkf and global_gsi are from github.com/NOAA-EMC/GSI.
calc_increment_ncio.x is from github.com/jswhit/GSI-utils (branch calc_inc_fix).
fv3-nonhydro.exe is from github.com/ufs-community/ufs-weather-model.

to turn off IAU, set iaudelthrs=-1 and iaufhrs=6 in config.sh
